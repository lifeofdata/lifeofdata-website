var debounce=function(func,wait,immediate){var timeout;return function(){var context=this,args=arguments;var later=function(){timeout=null;if(!immediate)func.apply(context,args)};if(immediate&&!timeout)func.apply(context,args);clearTimeout(timeout);timeout=setTimeout(later,wait)}};(function($){$.each(wptilesdata,function(key,tiledata){var el=document.getElementById(tiledata.id),grid=new Tiles.Grid(el),display_opts=tiledata.display_options;grid.resizeColumns=function(){return this.template.numCols};grid.createTile=function(data){var img=data.img,url=data.url,cats=data.categories,bylineExtra=data.byline,color=data.color,bylineColor=data.bylineColor,title=data.title,tile=new Tiles.Tile(data.id),hideByline=data.hideByline;var byline="";var bylineBgColor="";if(!hideByline){if(display_opts.bylineBg&&display_opts.bylineBg=="rand")bylineBgColor="background-color: "+bylineColor;else bylineBgColor="";if(img)byline="<div class='tile-byline' style='"+bylineBgColor+";'>\n";else byline="<div class='tile-byline tile-text-only'>\n";byline+="<div class='title'>"+title+"</div>";byline+="<div class='extra category'>"+bylineExtra+"</div>";byline+="</div>"}var tileClass="";tileClass+=cats.join(" ");if(img)tileClass+=" tile-bg";else tileClass+=" tile-color";if(hideByline)tileClass+=" hide-byline";if(img){tile.$el.append("<div class='"+tileClass+"' style='background-color: "+color+";background-image: url("+img+");' onclick='window.location=\""+url+"\"'>"+byline+"</div><!-- end .tile-bg -->")}else{tile.$el.append("<div class='"+tileClass+"' style='background-color:"+color+"' onclick='window.location=\""+url+"\"'>"+byline+"</div><!-- end .tile-bg -->")}return tile};var oldTemplate=false;if($("#"+tiledata.id).width()<tiledata.display_options.small_screen_width){$("div#"+tiledata.id+"-templates").hide();grid.template=Tiles.Template.fromJSON(tiledata.rowTemplates["small"]);oldTemplate=Tiles.Template.fromJSON(tiledata.rowTemplates[0])}else{$("div#"+tiledata.id+"-templates").show();grid.template=Tiles.Template.fromJSON(tiledata.rowTemplates[0])}grid.isDirty=true;grid.resize();grid.cellPadding=parseInt(display_opts.cellPadding);var posts=tiledata.posts;grid.updateTiles(posts);grid.redraw(true,resizeWpTiles);function resizeWpTiles(){var lastEl=$("#"+tiledata.id).children().last();var tileOffsetTop=parseInt($("#"+tiledata.id).offset().top);var newHeight=parseInt(lastEl.css("height"),10)+parseInt(lastEl.offset().top,10)-tileOffsetTop+10+"px";$('.wp-tile-container:has("#'+tiledata.id+'")').css("height",newHeight)}var debouncedResize=debounce(function(){if($("#"+tiledata.id).width()<tiledata.display_options.small_screen_width){$("div#"+tiledata.id+"-templates").hide();if(!oldTemplate)oldTemplate=grid.template;grid.template=Tiles.Template.fromJSON(tiledata.rowTemplates["small"]);grid.isDirty=true}else if(oldTemplate){$("div#"+tiledata.id+"-templates").show();grid.template=oldTemplate;oldTemplate=false;grid.isDirty=true}grid.resize();grid.redraw(true,resizeWpTiles)},200);$(window).resize(debouncedResize);var $templateButtons=$("#"+tiledata.id+"-templates li.template").on("click",function(e){$templateButtons.removeClass("selected");$(e.target).addClass("selected");var index=$(e.target).index(),rows=tiledata.rowTemplates[index];grid.template=Tiles.Template.fromJSON(rows);grid.isDirty=true;grid.resize();grid.redraw(true,resizeWpTiles)})});$(window).trigger("resize")})(jQuery);